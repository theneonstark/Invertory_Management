import{r,j as e,a as Y}from"./app-D_9NWQB4.js";import{L as G}from"./Layout-CXCnlBER.js";import{c as h,B as x}from"./index-DuVBRgeB.js";import{I as K,y as u}from"./index-CEfdmBI7.js";import{E as D,D as T,a as S,b as A,c as k,e as R}from"./dialog-D5k19jA-.js";/* empty css                      */import{o as z}from"./orders-iysFuNz8.js";import{I as j}from"./index-BlzXStvs.js";import"./index-DZW_afe8.js";const L=r.forwardRef(({className:n,...t},l)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:l,className:h("w-full caption-bottom text-sm",n),...t})}));L.displayName="Table";const I=r.forwardRef(({className:n,...t},l)=>e.jsx("thead",{ref:l,className:h("[&_tr]:border-b",n),...t}));I.displayName="TableHeader";const E=r.forwardRef(({className:n,...t},l)=>e.jsx("tbody",{ref:l,className:h("[&_tr:last-child]:border-0",n),...t}));E.displayName="TableBody";const M=r.forwardRef(({className:n,...t},l)=>e.jsx("tfoot",{ref:l,className:h("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",n),...t}));M.displayName="TableFooter";const y=r.forwardRef(({className:n,...t},l)=>e.jsx("tr",{ref:l,className:h("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",n),...t}));y.displayName="TableRow";const m=r.forwardRef(({className:n,...t},l)=>e.jsx("th",{ref:l,className:h("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",n),...t}));m.displayName="TableHead";const o=r.forwardRef(({className:n,...t},l)=>e.jsx("td",{ref:l,className:h("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",n),...t}));o.displayName="TableCell";const W=r.forwardRef(({className:n,...t},l)=>e.jsx("caption",{ref:l,className:h("mt-4 text-sm text-muted-foreground",n),...t}));W.displayName="TableCaption";const X="https://ims.nikatby.in/user/public/api/PayPendingPayment",Z={PendingPayment:async(n,t)=>Y.post(X,{order_id:n,payment_amount:t})};function ee(){const[n,t]=r.useState([]),[l,F]=r.useState(""),[H,B]=r.useState(!0),[P,Q]=r.useState(null),[i,v]=r.useState(null),[$,f]=r.useState(!1),[p,_]=r.useState(""),[q,b]=r.useState(!1);r.useEffect(()=>{(async()=>{try{const a=await z.getUserOrders();console.log(a);const d=a.orders.map(c=>({...c,products:JSON.parse(c.products)}));t(d||[])}catch(a){console.error("Error fetching orders:",a),Q("Failed to fetch orders. Please try again later.")}finally{B(!1)}})()},[]);const g=n.filter(s=>s.user_name.toLowerCase().includes(l.toLowerCase())||s.products.some(a=>a.product_name.toLowerCase().includes(l.toLowerCase())));if(H)return e.jsx("div",{children:"Loading..."});if(P)return e.jsx("div",{children:P});const w=s=>{v(s),_(""),f(!0)},U=s=>{const a=s.target.value,d=Number(a);d>=0&&d<=i.pending_payment?_(d):u.error("Amount should not exceed the pending payment.")},J=async()=>{var s,a;if(!i||!p||p<=0){u.error("Please enter a valid payment amount.");return}try{await Z.PendingPayment(i.id,p),u.success("Payment successful!"),t(d=>d.map(c=>c.id===i.id?{...c,pending_payment:String(Number(c.pending_payment)-Number(p))}:c)),f(!1)}catch(d){u.error(((a=(s=d.response)==null?void 0:s.data)==null?void 0:a.error)||"Payment failed. Please try again.")}},C=async s=>{var a,d;try{await z.cancelOrder(s),t(c=>c.map(N=>N.id===s?{...N,status:"canceled"}:N)),u.success("Order has been canceled.")}catch(c){u.error(((d=(a=c.response)==null?void 0:a.data)==null?void 0:d.error)||"Failed to cancel the order.")}},O=s=>{v(s),b(!0)},V=s=>new Date(s).toLocaleString();return e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Your Orders"}),e.jsx("div",{className:"mt-6 flex flex-col sm:flex-row gap-4",children:e.jsx(K,{placeholder:"Search orders...",value:l,onChange:s=>F(s.target.value)})}),e.jsx("div",{className:"mt-4 border rounded-lg hidden lg:block",children:e.jsxs(L,{children:[e.jsx(I,{children:e.jsxs(y,{children:[e.jsx(m,{children:"Order ID"}),e.jsx(m,{children:"Products"}),e.jsx(m,{children:"Quantity"}),e.jsx(m,{children:"Address"}),e.jsx(m,{children:"Total"}),e.jsx(m,{children:"Pending Amount"}),e.jsx(m,{children:"Paid Amount"}),e.jsx(m,{children:"Payment Status"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(E,{children:g.length>0?g.map(s=>e.jsxs(y,{className:"border-b",children:[e.jsx(o,{children:s.id}),e.jsxs(o,{children:[s.products.length," Products"]}),e.jsx(o,{children:s.products.reduce((a,d)=>a+d.quantity,0)}),e.jsxs(o,{children:[s.user_address,", ",s.user_city,", ",s.user_zip]}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{size:15}),s.total_amount]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{size:15}),s.pending_payment]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{size:15}),s.paid_payment]})}),e.jsx(o,{children:Number(s.pending_payment)>0?e.jsx("span",{className:"text-red-500 font-semibold",children:"Pending"}):e.jsx("span",{className:"text-green-500 font-semibold",children:"Paid"})}),e.jsx(o,{children:e.jsxs("div",{className:"flex gap-2 justify-center items-center",children:[e.jsxs(x,{className:`
        text-white px-3 py-1
        ${s.status==="canceled"&&"bg-orange-400"}
        ${s.status==="pending"&&"bg-red-500"}
        ${s.status==="paid"&&"bg-green-500"}
      `,onClick:()=>w(s),disabled:Number(s.pending_payment)<=0||s.status==="canceled",style:{flex:1},children:[s.status==="canceled"&&"canceled",s.status==="pending"&&"pay pending",s.status==="paid"&&"paid"]}),e.jsx(x,{className:"bg-gray-600 text-white px-3 py-1",onClick:()=>O(s),style:{flex:1},children:e.jsx(D,{size:16})}),s.status!=="canceled"&&s.status!=="paid"&&e.jsx(x,{className:"bg-yellow-600 text-white px-3 py-1",onClick:()=>C(s.id),style:{flex:1},children:"Cancel"})]})})]},s.id)):e.jsx(y,{children:e.jsx(o,{colSpan:8,className:"text-center py-4",children:"No orders found."})})})]})}),e.jsx("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 lg:hidden gap-4",children:g.length>0?g.map(s=>e.jsxs("div",{className:"border p-4 rounded-lg shadow-md",children:[e.jsxs("h3",{className:"font-semibold",children:["Order ID: ",s.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Products:"})," ",s.products.length," Products"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Quantity:"})," ",s.products.reduce((a,d)=>a+d.quantity,0)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total:"})," ",s.total_amount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pending Payment:"})," ",s.pending_payment]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",s.user_address]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(x,{className:`${Number(s.pending_payment)>0&&s.status!=="canceled"?"bg-red-600":"bg-orange-600"} text-white px-3 py-1`,onClick:()=>w(s),disabled:Number(s.pending_payment)<=0||s.status==="canceled",children:Number(s.pending_payment)>0&&s.status!=="canceled"?"Pay Pending":"canceled"}),e.jsx(x,{className:"bg-gray-600 text-white px-3 py-1",onClick:()=>O(s),children:e.jsx(D,{size:16})}),s.status!=="canceled"&&e.jsx(x,{className:"bg-yellow-600 text-white px-3 py-1",onClick:()=>C(s.id),children:"Cancel"})]})]},s.id)):e.jsx("div",{children:"No orders found."})}),e.jsx(T,{open:$,onOpenChange:f,children:e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(k,{children:"Pay Pending Payment"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Enter Amount"}),e.jsx("input",{type:"number",value:p,onChange:U,className:"border p-2 mt-2 rounded-md w-full"})]}),e.jsx(R,{children:e.jsx(x,{onClick:J,disabled:Number(p)<=0,children:"Pay Now"})})]})}),e.jsx(T,{open:q,onOpenChange:b,children:e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(k,{children:"Order Details"})}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Order ID:"})," ",i.id]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Created At:"})," ",V(i.created_at)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone"})," ",i.user_phone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Delivered At:"})," ",i.delivered_date?i.delivered_date:"Not Delivered"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Address:"})," ",i.user_address,", ",i.user_city,", ",i.user_zip]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Total Amount:"})," ",e.jsx(j,{size:15})," ",i.total_amount]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Payment Status:"})," ",i.pending_payment==="0"?"Paid":"Pending"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Products:"}),e.jsx("ul",{className:"list-disc pl-5 ",children:i.products.map((s,a)=>e.jsxs("li",{className:"flex items-center gap-2",children:[s.product_name," - ",s.quantity," x ",e.jsx(j,{size:15})," ",s.product_price," = ",e.jsx(j,{size:15})," ",s.total_price]},a))})]})]}),e.jsx(R,{children:e.jsx(x,{onClick:()=>b(!1),children:"Close"})})]})})]})}function oe(){return e.jsx(G,{children:e.jsx(ee,{})})}export{oe as default};
