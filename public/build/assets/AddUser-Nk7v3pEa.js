import{r as o,j as e,y as n}from"./app-By9T3_hT.js";import{u as k}from"./index.esm-CfDLc69O.js";import{C as M,b as P,c as T,a as $}from"./card-CSknuUnI.js";import{I as c,B as d}from"./index-BnX6mjkZ.js";import{e as B,F as j,a as m,b as i,c as x,d as h}from"./form-D4nV-YtK.js";import{S as H,e as q,g as G,i as O,j as z}from"./select-T4vt2RfK.js";import{D as J,a as K,b as Q,c as W,d as X,e as Y}from"./dialog-CPdFLB40.js";import{F as p,a as Z,b as F,c as _,d as ee,e as U}from"./index-BRwulAh7.js";import{x as v,y as se,A as ae,B as re}from"./navbar-CwT8qYnT.js";import{L as te}from"./Layout-B2cxh-r7.js";import"./label-CFASl-Vv.js";function le({id:t}){const[N,y]=o.useState(!1),[g,f]=o.useState(""),[S,E]=o.useState([]),[b,D]=o.useState(null),r=k({defaultValues:{name:"",email:"",role:"",password:""}});o.useEffect(()=>{t&&(async()=>{try{const a=await v(t);D(a),r.reset({name:a.name||"",email:a.email||"",role:a.role||"",password:""})}catch(a){console.error("Error fetching user data:",a),n.error("Failed to fetch user data")}})()},[t,r]);const w=s=>{if(!s)return"";const a=Math.random().toString(36).slice(-4),u=Math.floor(1e3+Math.random()*9e3);return`${s.replace(/\s+/g,"").toLowerCase()}@${a}${u}`},R=s=>{const a=s.target.value;r.setValue("name",a),t||r.setValue("password",w(a))},A=()=>{const s=r.getValues("name");r.setValue("password",w(s))},C=async()=>{try{const s=await se();E(s||[])}catch(s){console.error("Error fetching roles:",s)}};o.useEffect(()=>{C()},[]);const L=async s=>{var a,u;y(!0);try{if(t){const l={...s};l.password||delete l.password;const I=await v(t,l);console.log("Updated user data:",I),n.success("User updated successfully")}else{const l=await ae(s);console.log("Created new user:",l),n.success("User added successfully")}r.reset()}catch(l){console.error("Error submitting form:",l),n.error(`Error: ${((u=(a=l.response)==null?void 0:a.data)==null?void 0:u.message)||"Failed to process request"}`)}finally{y(!1)}},V=async()=>{if(g.trim())try{await re(g),n.success("Role added successfully"),f(""),C()}catch(s){console.error("Error adding role:",s),n.error("Failed to add role")}};return e.jsx("div",{className:"h-[90vh] flex items-center justify-center bg-gray-50",children:e.jsxs(M,{className:"w-full max-w-2xl mx-auto shadow-lg rounded-lg bg-white",children:[e.jsx(P,{children:e.jsx(T,{className:"text-2xl font-bold text-gray-800",children:t?"Update User":"Add New User"})}),e.jsx($,{children:e.jsx(B,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(L),className:"space-y-6",children:[e.jsx(j,{control:r.control,name:"name",render:({field:s})=>e.jsxs(m,{className:"flex items-center space-x-3",children:[e.jsxs(i,{className:"flex items-center text-gray-600",children:[e.jsx(p,{className:"mr-2 text-blue-500"})," Name"]}),e.jsx(x,{children:e.jsx(c,{...s,onChange:R,placeholder:"Enter name"})}),e.jsx(h,{})]})}),e.jsx(j,{control:r.control,name:"email",render:({field:s})=>e.jsxs(m,{className:"flex items-center space-x-3",children:[e.jsxs(i,{className:"flex items-center text-gray-600",children:[e.jsx(Z,{className:"mr-2 text-blue-500"})," Email"]}),e.jsx(x,{children:e.jsx(c,{...s,type:"email",placeholder:"Enter email"})}),e.jsx(h,{})]})}),b&&e.jsxs(m,{className:"flex items-center space-x-3",children:[e.jsxs(i,{className:"flex items-center text-gray-600",children:[e.jsx(F,{className:"mr-2 text-blue-500"})," Current Role"]}),e.jsx(x,{children:e.jsx(c,{readOnly:!0,value:b.role})}),e.jsx(h,{})]}),e.jsx(j,{control:r.control,name:"role",render:({field:s})=>e.jsxs(m,{className:"flex items-center space-x-3",children:[e.jsxs(i,{className:"flex items-center text-gray-600",children:[e.jsx(F,{className:"mr-2 text-blue-500"})," Role"]}),e.jsxs(H,{onValueChange:s.onChange,value:s.value,children:[e.jsx(x,{children:e.jsx(q,{children:e.jsx(G,{placeholder:"Select a role"})})}),e.jsx(O,{children:S.map(a=>e.jsx(z,{value:a.name,children:a.name},a.id))})]}),e.jsx(h,{})]})}),e.jsx(j,{control:r.control,name:"password",render:({field:s})=>e.jsxs(m,{className:"flex items-center space-x-3",children:[e.jsxs(i,{className:"flex items-center text-gray-600",children:[e.jsx(_,{className:"mr-2 text-blue-500"})," Password"]}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{...s,placeholder:t?"Enter new password (optional)":"Generated password"}),e.jsxs(d,{type:"button",onClick:A,className:"bg-gray-500 hover:bg-gray-600",children:[e.jsx(ee,{className:"mr-2"})," Regenerate"]})]})}),e.jsx(h,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsxs(J,{children:[e.jsx(K,{asChild:!0,children:e.jsxs(d,{className:"bg-green-500 hover:bg-green-600 flex items-center",children:[e.jsx(U,{className:"mr-2"})," Add Role"]})}),e.jsxs(Q,{children:[e.jsx(W,{children:e.jsx(X,{children:"Add New Role"})}),e.jsxs("div",{className:"p-4",children:[e.jsx(c,{value:g,onChange:s=>f(s.target.value),placeholder:"Enter new role"}),e.jsxs(Y,{className:"mt-4",children:[e.jsxs(d,{onClick:V,className:"bg-green-500 hover:bg-green-600",children:[e.jsx(U,{className:"mr-2"})," Add Role"]}),e.jsx(d,{variant:"outline",onClick:()=>f(""),children:"Cancel"})]})]})]})]}),e.jsx(d,{type:"submit",className:"bg-[#7C3AED] hover:bg-[#6D28D9] flex items-center",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"animate-spin mr-2"})," ",t?"Updating...":"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"mr-2"})," ",t?"Update User":"Add User"]})})]})]})})})]})})}function fe({id:t}){return e.jsx(te,{children:e.jsx(le,{id:t})})}export{fe as default};
